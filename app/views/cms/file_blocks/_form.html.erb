<% 
  @sections = Section.all(:order => "name") 
  @block.attachment_file_name = @block.attachment.file_name if @block.attachment_file_name.blank? && !@block.new_record?
%>
<% content_for :html_head do %>
  <% if @block.new_record? %>
    <script type="text/javascript">
    jQuery(function($){
      var sectionIdPathMap = <%= @sections.inject({}){|map, sec| map[sec.id.to_s] = sec.path.sub(/\/$/,''); map}.to_json %>
      $('#file_block_attachment_file, #file_block_section_id').change(function(){ 
        $('#file_block_attachment_file_name').val(sectionIdPathMap[$('#file_block_section_id').val()]+'/'+$('#file_block_attachment_file').val()) 
      }) 
    })
    </script>
  <% end %>
<% end %>
<div class="fields text_fields">
  <%= f.label :name %>
  <%= f.text_field :name %>
</div>
<div class="fields text_fields">
  <%= f.label :attachment_file %>
  <%= f.file_field :attachment_file %>
</div>
<div class="fields text_fields">
  <%= f.label :section_id, "Section" %>
  <%= f.collection_select :section_id, @sections, :id, :name %>
</div>
<div class="fields text_fields">
  <%= f.label :attachment_file_name %>
  <%= f.text_field :attachment_file_name %>
</div>
