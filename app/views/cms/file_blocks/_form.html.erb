<% 
   root = Section.root.first
   root.full_path = root.name
   @sections = []
   @sections << root
   @sections += root.all_children_with_name
   @sections.each {|s| s.full_path = "/" + s.full_path unless s == root }
  @block.attachment_file_path = @block.attachment.file_path if @block.attachment_file_path.blank? && !@block.new_record?
%>
<% content_for :html_head do %>
  <%= stylesheet_link_tag "cms/taglist" %>
  <%= javascript_include_tag "jquery.dimensions", "jquery.taglist", "/cms/tags" %>
  <% javascript_tag do %>
    jQuery(function($) {
      $('#file_block_attachment_file_div').mousemove(function(e) {
        $('#file_block_attachment_file').css('margin-left', (e.pageX - 700) + 'px');
      });
      $('#file_block_attachment_file').mousemove(function(e) {
        if (e.pageX < 1050 && e.pageX > 650){
          $('#file_block_attachment_file').css('margin-left', (e.pageX - 700) + 'px');
	}
      });
      $('.tag-list').tagList(tags)
      $('#file_block_attachment_section_id').selectbox({width: '210px'});
      $('#file_block_attachment_file').change(function(){
        $('#mock_file_block_attachment_file').attr('value', $(this).attr('value'))
      });
      <% if @block.new_record? %>
        var sectionIdPathMap = <%= @sections.inject({}){|map, sec| map[sec.id.to_s] = sec.path.sub(/\/$/,''); map}.to_json %>
        $('#file_block_attachment_file, #file_block_attachment_section_id').change(function(){ 
            $('#file_block_attachment_file_path').val(sectionIdPathMap[$('#file_block_attachment_section_id').val()]+'/'+$.cms.sanitizeFileName($('#file_block_attachment_file').val())) 
        })
      <% end %>      
    });    
  <% end %>
<% end %>
<div class="fields text_fields">
  <%= f.label :name %>
  <%= f.text_field :name, :tabindex => (@tabindex += 1) %>
</div>
<div class="fields file_fields">
  <%= f.label :attachment_file, "File" %>
  <div id="file_block_attachment_file_div">
  <input type="text" name="temp" class="mock" id="mock_file_block_attachment_file" />
  <%= image_tag("cms/browse.gif") %>
  </div>
  <%= f.file_field :attachment_file, :tabindex => (@tabindex += 1), :size => '1' %>

</div>
<div class="fields text_fields">
  <%= f.label :attachment_section_id, "Section" %>
  <%= f.collection_select :attachment_section_id, @sections, :id, :full_path, :tabindex => (@tabindex += 1) %>
</div>
<div class="fields text_fields">
  <%= f.label :attachment_file_path, "Path" %>
  <%= f.text_field :attachment_file_path, :tabindex => (@tabindex += 1) %>
</div>
<div class="fields text_fields">
  <%= f.label :tag_list, "Tags" %>
  <%= f.tag_list :tabindex => (@tabindex += 1) %>
</div>
