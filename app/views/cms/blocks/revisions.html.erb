<% @page_title = "Content Library / List of Versions" %>
<% @toolbar_title = "List Versions / '#{@block.name}' #{@content_type.display_name}" %>
<% content_for :html_head do %>
<%= stylesheet_link_tag("cms/content_library") %>
  <% javascript_tag do %>
    jQuery(function($){
      $('table.data tbody tr').hover(function(){
        $(this).addClass('hover')
      }, function(){
        $(this).removeClass('hover')
      }).click(function(){
        var match = this.id.match(/(.*)_(\d+)/) 
        var type = match[1]
        var id = match[2]
        $('table.data tbody tr').removeClass('selected')
        $(this).addClass('selected')
        $('#functions .button').addClass('disabled').attr('href','#')
        $('#functions .off span').css('color', '#FFFFFF')
        $('#list_all').removeClass('disabled').attr('href', '<%= cms_path(:blocks, @content_type.content_block_type) %>');
        $('#add_button').removeClass('disabled').attr('href', '/cms/blocks/'+type+'/new')
        $('#view_button').removeClass('disabled').attr('href', '/cms/blocks/'+type+'/show_version/<%= @block.id %>?version='+id)  
        var current = $(this).find('.current')
        if(current.length == 0) {
          $('#revert_button').removeClass('disabled').attr('href', '/cms/blocks/'+type+'/revert_to/<%= @block.id %>?version='+id)  
        } else {
          $('#view_button').attr('href', '/cms/blocks/'+type+'/show/<%= @block.id %>');
          $('#edit_button').removeClass('disabled').attr('href', '/cms/blocks/'+type+'/edit/<%= @block.id %>');
        }
      })
    })
  <% end %>

<% end %>
<% content_for :functions do %>
<%= render(:partial => 'toolbar', :locals => {:dynamic_buttons => true}) %>
<%= link_to span_tag("Revert"), "#", :id=>"revert_button", :class => "button disabled"  %>
<% end %>
<div class="roundedcorners">
  <table id="blocks" class="data">
  <thead>
  <tr>
    <th colspan="2" class="first"><div class="dividers">Version</div></th>
      <% if @content_type.model_class.publishable? %><th colspan="2"><div class="dividers">Status</div></th><% end %>
      <th><div class="dividers">Comment</div></th>
    <th><div class="dividers">Date</div></th>
    <th class="last" colspan="2"><div class="dividers">Editor</div></th>
  </tr>
  </thead>
  <tbody>
  <% @block.versions.all(:order => "version desc").each_with_index do |r, i| %>
  <% published_status = (r.published? ? 'published' : 'draft') %>
      <tr id="<%= @block.class.name.underscore %>_<%= r.version %>">
	<td class="first"></td>
    <td><div class="dividers"><%= "v. #{r.version}" %><%= ' (LIVE)' if @block.live_version && r.version == @block.live_version.version %><%= '<span class="current"> (CURRENT)</span>' if i == 0 %></div></td>
        <% if @content_type.model_class.publishable? %><td class="block_status"><%= status_icon(published_status) %></td><td><div class="dividers"><%= published_status %></div> </td><% end %>
    <td><div class="dividers"><%=  r.version_comment %></div></th>
    <td><div class="dividers"><%= r.created_at.strftime("%b %d, %Y %I:%M %p") if r.created_at %></div></th>
    <td><div><%= r.updated_by.login if r.updated_by %></div></th>
    <td class="last"></td>

  </tr>
  <% end %>
      <tr>
	<td colspan="8" class="buffer"></td>
      </tr>
    </tbody>
  </table>
  <div class="tl"></div>
  <div class="tr"></div>
  <div class="bl"></div>
  <div class="br"></div>
</div>

