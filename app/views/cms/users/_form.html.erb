<% form_for(@user, :url => cms_path(@user, :create_or_update)) do |f| %>
  <%= f.error_messages %>
  <%= render :partial => 'user_fields', :locals => {:f => f} unless @change_password %>
  <%= render :partial => 'password', :locals => {:f => f}  if ( @user.new_record? || @change_password) %>
  <div class="buttons">
    <%= f.submit "Save" %>
  </div>
<% end %>